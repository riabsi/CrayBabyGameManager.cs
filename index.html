<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Girl Adventure</title>

<style>
body {
    margin: 0;
    overflow: hidden;
    background: #000;
    touch-action: none;
}
#controls {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    z-index: 10;
}
.btn {
    width: 80px;
    height: 80px;
    background: rgba(0,150,255,0.8);
    border-radius: 50%;
    border: 3px solid #fff;
    color: white;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
}
</style>
</head>

<body>

<div id="controls">
    <div class="btn" id="leftBtn">LEFT</div>
    <div class="btn" id="rightBtn">RIGHT</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>

<script>
let scene, camera, renderer, clock;
let girl, mixer;
let idleAction = null;
let walkAction = null;
let moveX = 0;

init();
animate();

function init() {

    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);

    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, 12);

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    clock = new THREE.Clock();

    // إضاءة
    scene.add(new THREE.AmbientLight(0xffffff, 1.2));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
    dirLight.position.set(5, 10, 5);
    scene.add(dirLight);

    // أرضية
    const ground = new THREE.Mesh(
        new THREE.PlaneGeometry(500, 500),
        new THREE.MeshStandardMaterial({ color: 0x55aa55 })
    );
    ground.rotation.x = -Math.PI / 2;
    scene.add(ground);

    // تحميل المجسم (المهم)
    const loader = new THREE.GLTFLoader();
    loader.load('Assets/chibi_girl_character.glb', function (gltf) {

        girl = gltf.scene;
        girl.scale.set(1.5, 1.5, 1.5);
        scene.add(girl);

        mixer = new THREE.AnimationMixer(girl);

        let idleClip = null;
        let walkClip = null;

        console.log("Animations found:");
        gltf.animations.forEach(clip => {
            console.log(" -", clip.name);
            const n = clip.name.toLowerCase();

            // تجاهل الزحف
            if (n.includes("crawl") || n.includes("prone")) return;

            if (!walkClip && (n.includes("walk") || n.includes("run"))) {
                walkClip = clip;
            }

            if (!idleClip && n.includes("idle")) {
                idleClip = clip;
            }
        });

        if (idleClip) {
            idleAction = mixer.clipAction(idleClip);
            idleAction.play();
            console.log("Idle selected:", idleClip.name);
        }

        if (walkClip) {
            walkAction = mixer.clipAction(walkClip);
            console.log("Walk selected:", walkClip.name);
        }

        if (!idleClip && !walkClip) {
            console.warn("⚠️ No suitable animation found — static pose");
        }
    });
}

// التحكم
document.getElementById('leftBtn').onpointerdown = () => {
    moveX = -0.08;
    if (girl) girl.rotation.y = Math.PI / 2;
    startWalk();
};

document.getElementById('rightBtn').onpointerdown = () => {
    moveX = 0.08;
    if (girl) girl.rotation.y = -Math.PI / 2;
    startWalk();
};

window.onpointerup = stopWalk;

function startWalk() {
    if (walkAction) {
        if (idleAction) idleAction.stop();
        walkAction.reset().play();
    }
}

function stopWalk() {
    moveX = 0;
    if (walkAction) walkAction.stop();
    if (idleAction) idleAction.reset().play();
}

function animate() {
    requestAnimationFrame(animate);

    const delta = clock.getDelta();
    if (mixer) mixer.update(delta);

    if (girl) {
        girl.position.x += moveX;
        camera.position.x = girl.position.x;
        camera.lookAt(girl.position.x, 2, 0);
    }

    renderer.render(scene, camera);
}
</script>

</body>
</html>


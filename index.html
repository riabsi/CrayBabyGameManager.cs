<!DOCTYPE html>
<html>
<head>
    <title>Three.js Character Controller</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body { margin: 0; background-color: #000; color: #fff; overflow: hidden; }
    </style>
</head>
<body>
    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.128.0/build/three.module.js';
        import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.128.0/examples/jsm/loaders/GLTFLoader.js';

        class CharacterControllerProxy {
            constructor(animations) { this._animations = animations; }
            get animations() { return this._animations; }
        }

        class GameScene {
            constructor() { this._Initialize(); }

            _Initialize() {
                this._threejs = new THREE.WebGLRenderer({ antialias: true });
                this._threejs.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(this._threejs.domElement);

                this._scene = new THREE.Scene();
                this._camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
                this._camera.position.set(0, 10, 20);

                const light = new THREE.DirectionalLight(0xFFFFFF, 1.0);
                light.position.set(20, 100, 10);
                this._scene.add(light);
                this._scene.add(new THREE.AmbientLight(0x404040));

                this._mixers = [];
                this._previousRAF = null;

                this._LoadModel();
                this._RAF();
            }

            _LoadModel() {
                const loader = new GLTFLoader();
                // هنا يتم وضع رابط أي ملف GLB من الإنترنت
                loader.load('./Assets/zombie.glb', (gltf) => {
                    const model = gltf.scene;
                    this._scene.add(model);

                    const m = new THREE.AnimationMixer(model);
                    this._mixers.push(m);

                    // تشغيل كل الحركات الموجودة في الملف الأصلي
                    gltf.animations.forEach((clip) => {
                        m.clipAction(clip).play();
                    });
                });
            }

            _RAF() {
                requestAnimationFrame((t) => {
                    if (this._previousRAF === null) { this._previousRAF = t; }
                    this._Step(t - this._previousRAF);
                    this._threejs.render(this._scene, this._camera);
                    this._previousRAF = t;
                    this._RAF();
                });
            }

            _Step(timeElapsed) {
                const timeElapsedS = timeElapsed * 0.001;
                if (this._mixers) { this._mixers.map(m => m.update(timeElapsedS)); }
            }
        }

        let _APP = null;
        window.addEventListener('DOMContentLoaded', () => { _APP = new GameScene(); });
    </script>
</body>
</html>

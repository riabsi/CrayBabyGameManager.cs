<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cray Baby - Horror World</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; touch-action: none; }
        #controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 20px; z-index: 10; }
        .btn { width: 65px; height: 65px; background: rgba(255,0,0,0.3); border: 2px solid #ff0000; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; user-select: none; cursor: pointer; font-family: Arial; font-weight: bold; }
    </style>
</head>
<body>

    <div id="controls">
        <div class="btn" id="leftBtn">يسار</div>
        <div class="btn" id="jumpBtn">قفز</div>
        <div class="btn" id="rightBtn">يمين</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>

    <script>
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x020202);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        const redLight = new THREE.PointLight(0xff0000, 2, 50);
        redLight.position.set(0, 5, 5);
        scene.add(redLight);

        const textureLoader = new THREE.TextureLoader();
        const groundTex = textureLoader.load('أصول/unnamed (19).jpg');
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(100, 100),
            new THREE.MeshStandardMaterial({ map: groundTex || null, color: 0x444444 })
        );
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        const loader = new THREE.GLTFLoader();
        let player, zombie, dog, girl;

        function loadModel(fileName, scale, posX, posZ, callback) {
            const path = 'أصول/' + fileName;
            loader.load(path, function(gltf) {
                const model = gltf.scene;
                model.scale.set(scale, scale, scale);
                model.position.set(posX, 0, posZ);
                scene.add(model);
                if (callback) callback(model);
            }, undefined, function() {
                loader.load('Assets/' + fileName, function(gltf) {
                    const model = gltf.scene;
                    model.scale.set(scale, scale, scale);
                    model.position.set(posX, 0, posZ);
                    scene.add(model);
                    if (callback) callback(model);
                });
            });
        }

        // 1. البطل
        loadModel('cyber_warrior.glb', 0.05, 0, 0, function(m) { player = m; });

        // 2. الزومبي
        loadModel('zombie.glb', 0.05, 0, -15, function(m) { zombie = m; });

        // 3. كلب الزومبي
        loadModel('zombie_dog.glb', 0.02, -5, -10, function(m) { dog = m; });

        // 4. الفتاة اللطيفة (إضافة جديدة بناءً على طلبك)
        loadModel('chibi_girl_character.glb', 0.04, 5, -5, function(m) { girl = m; });

        camera.position.set(0, 6, 18);

        // تعديل التحكم ليعمل على المتصفحات الحديثة والموبايل بدقة
        let moveLeft = false, moveRight = false, isJumping = false;
        let jumpVelocity = 0;

        const setLeft = (val) => moveLeft = val;
        const setRight = (val) => moveRight = val;

        document.getElementById('leftBtn').onpointerdown = () => setLeft(true);
        document.getElementById('leftBtn').onpointerup = () => setLeft(false);
        document.getElementById('rightBtn').onpointerdown = () => setRight(true);
        document.getElementById('rightBtn').onpointerup = () => setRight(false);
        
        document.getElementById('jumpBtn').onclick = () => { 
            if(!isJumping && player) { 
                isJumping = true; 
                jumpVelocity = 0.25; 
            } 
        };

        function animate() {
            requestAnimationFrame(animate);

            if (player) {
                if (moveLeft) player.position.x -= 0.15;
                if (moveRight) player.position.x += 0.15;
                if (isJumping) {
                    player.position.y += jumpVelocity;
                    jumpVelocity -= 0.015;
                    if (player.position.y <= 0) { player.position.y = 0; isJumping = false; }
                }
                camera.position.x = player.position.x;
                camera.lookAt(player.position.x, 2, player.position.z);
                redLight.position.set(player.position.x, 5, player.position.z + 2);
            }

            if (zombie && player) {
                zombie.position.z += 0.04;
                zombie.lookAt(player.position);
            }
            if (dog && player) {
                dog.position.z += 0.06;
                dog.lookAt(player.position);
            }

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
